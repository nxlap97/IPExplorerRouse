angular.module("umbraco").controller("cmsimport.dashboardController",function(n,t,i,r,u,f,e,o){n.bindData=function(){e.initializeDashboard().then(function(t){n.model=t.data;n.loaded=!0},function(){o.showServerError()})};n.upload=function(){var n=document.getElementById("selectLicenseFile");o.uploadFiles("uploadlicense",n.files[0],function(n){e.processLicenseFile(n).then(function(n){var t=n.data;o.showNotification(t.notificationStatus);r.reload()})})};n.bindData()});angular.module("umbraco").controller("cmsimport.deleteController",function(n,t,i,r,u){n.performDelete=function(){n.currentNode.loading=!0;r.removeNode(n.currentNode);t.deleteTreeNodeById(n.currentNode.id).then(function(){n.currentNode.loading=!1;i.success("Deleted","Definition "+n.currentNode.name+" is deleted");u.hideMenu()})};n.cancel=function(){u.hideDialog()}});angular.module("umbraco").controller("cmsimport.wizardController",function(n,t,r,u,f,e,o,s){n.bindData=function(){o.initializeWizard(r.id).then(function(t){n.model=t.data;n.loaded=!0;s.syncPath(n.model.path);n.setNextAction()},function(){s.showServerError()})};n.upload=function(n){var t=u.defer(),r=[];for(i=0;i<n.length;i++)r.push(n[i]);return t.resolve(r),t.promise};n.setNextAction=function(){t.next=function(){o.goNext(n.model).then(function(t){n.model=t.data;n.model.currentStep.stepAlias==="step6"&&n.frm.$setPristine()},function(){s.showServerError()})}};n.goNext=function(){t.next()};n.goPrevious=function(){o.goPrevious(n.model).then(function(t){n.model=t.data},function(){s.showServerError()})};n.save=function(){var t={view:"/app_plugins/cmsimport/dialogs/savedefinitiondialog.html",size:"small",stateId:n.model.stateId,parentStateId:n.model.parentStateId,submit:function(t){n.model.stateId=t.definitionId;n.model.stateName=t.name;o.saveDefinitionModel(n.model).then(function(t){s.syncPath(t.data.path);s.showNotification(t.data.notificationStatus);n.frm.$setPristine()},function(){s.showServerError()});e.close()},close:function(){e.close()}};e.open(t)};n.updateModel=function(){o.updateModel(n.model).then(function(t){var i=t.data,r=i.currentStep.stepAlias;s.updateTab(n.model,i,r)},function(){s.showServerError()})};t.$on("cmsimportBooleanCheckbox.changed",function(){n.updateModel()});t.$on("cmsimportDropdown.changed",function(){n.updateModel()});t.$on("cmsimportPageTitle.changed",function(t,i){n.model.currentStep.stepTitle=i.title;n.model.currentStep.stepIntro=i.description});t.upload=function(){};n.bindData()});angular.module("umbraco").controller("cmsimport.mailSettingsController",function(n,t,i,r,u,f){n.bindData=function(){u.initializeEmailSettings(t.id).then(function(t){n.model=t.data;n.loaded=!0;f.syncPath(n.model.path)},function(){f.showServerError()})};n.save=function(){u.saveEmailSettings(n.model).then(function(t){n.model=t.data;n.model.isInValid||(n.frm.$setPristine(),f.showNotification(n.model.notificationStatus))},function(){f.showServerError()})};n.bindData()});angular.module("umbraco").controller("cmsimport.dashboardSettingsController",function(n,t,i,r,u,f){n.bindData=function(){u.initializeDashboardSettings().then(function(t){n.model=t.data;n.loaded=!0;f.syncPath(n.model.path)},function(){f.showServerError()})};n.save=function(){u.saveDashboardSettings(n.model).then(function(t){n.model=t.data;n.model.isInValid||(n.frm.$setPristine(),f.showNotification(n.model.notificationStatus))},function(){f.showServerError()})};n.bindData()});angular.module("umbraco").controller("cmsimport.mediaSettingsController",function(n,t,i,r,u,f,e){n.bindData=function(){f.initializeMediaSettings().then(function(t){n.model=t.data;n.loaded=!0;e.syncPath(n.model.path)},function(){e.showServerError()})};n.save=function(){f.saveMediaSettings(n.model).then(function(t){var i=t.data;i.isInValid||(n.frm.$setPristine(),e.showNotification(i.notificationStatus))},function(){e.showServerError()})};n.bindData()});angular.module("umbraco").controller("cmsimport.ScheduleDialogController",function(n,t,i,r,u){n.initializeDialog=function(){n.loaded=!0;n.parentModel=n.model;r.initializeScheduledTask(i.id).then(function(t){n.model=t.data;n.loaded=!0;u.syncPath(n.model.path)});n.loaded=!0};n.updateModel=function(){r.updateScheduledTask(n.model).then(function(t){n.model=t.data},function(){u.showServerError()})};n.save=function(){r.saveScheduledTask(n.model).then(function(t){n.model=t.data;u.syncPath(n.model.path);u.showNotification(n.model.notificationStatus);n.frm.$setPristine()})};n.onCancel=function(){n.parentModel.close()};t.$on("cmsimportBooleanCheckbox.changed",function(){n.updateModel()});t.$on("cmsimportDropdown.changed",function(){n.updateModel()});t.$on("cmsimportRadioButton.changed",function(t,i){n.model.selectRadioOption=i.alias;n.updateModel()});n.initializeDialog()});angular.module("umbraco").controller("cmsimport.ScheduleLogController",function(n,t,i,r,u){n.initialize=function(){r.initializeScheduledLog(i.id).then(function(t){n.model=t.data;n.loaded=!0;u.syncPath(n.model.path)})};n.clearLog=function(){var f={localizationKey:"cmsimportScheduledTaskLog_confirmMessage",view:"/app_plugins/cmsimport/dialogs/confirm.html",size:"small",submit:function(){r.clearScheduledLog(i.id).then(function(t){n.model=t.data;u.showNotification(n.model.notificationStatus)});t.close()},close:function(){t.close()}};t.open(f)};n.initialize()});angular.module("umbraco").controller("cmsimport.ConfirmDialogController",function(n,t){n.initializeConfirm=function(){t.localize(n.model.localizationKey).then(function(t){n.confirmCaption=t})};n.confirm=function(){n.model&&n.model.close&&n.model.submit()};n.cancel=function(){n.model&&n.model.close&&n.model.close()};n.initializeConfirm()});angular.module("umbraco").controller("cmsimport.SaveDefinitionController",function(n,t){n.initializeSave=function(){n.loaded=!0;n.parentModel=n.model;t.initializeDefinitionSave(n.parentModel.stateId,n.parentModel.parentStateId).then(function(t){n.model=t.data;n.loaded=!0});n.loaded=!0};n.save=function(){t.validateDefinitionSaveModel(n.model).then(function(t){n.model=t.data;n.model.isInValid||n.parentModel.submit(n.model)})};n.onCancel=function(){n.parentModel.close()};n.initializeSave()});angular.module("umbraco.directives").directive("file",function(){return{require:"ngModel",restrict:"A",link:function(n,t,i,r){t.bind("change",function(t){var i=t.target.files,u=i[0];r.$setViewValue(u,t);n.$apply()})}}});angular.module("umbraco.directives").directive("cmsimportLicenseinfo",function(n){return{transclude:!0,restrict:"E",replace:!0,link:function(t,i){n.getLicenseInfo().then(function(n){n.data.licenseError===!0&&i.html('<div class="alert alert-error cmsimportLicenseInfo">'+n.data.licenseMessage+"<\/div>");n.data.trialLicense===!0&&i.html('<div class="alert alert-warning cmsimportLicenseInfo">'+n.data.licenseMessage+"<\/div>")})}}});angular.module("umbraco").controller("cmsimport.TemplateEditorFieldController",function(n,t){t.loadCss("lib/ace-razor-mode/theme/razor_chrome.css",n);n.aceConfig={mode:"razor",theme:"chrome",showPrintMargin:!1,advanced:{fontSize:"14px",enableSnippets:!1,enableBasicAutocompletion:!0,enableLiveAutocompletion:!1}}});angular.module("umbraco").controller("cmsimport.propertyMappingController",function(n,t){n.toggleForm=function(n){n.showAdvancedOptionsForm=!n.showAdvancedOptionsForm};n.isMapped=function(n){return!t.isNullOrEmptyString(n.mappedDataSourceColumn)};n.showAdvancedOptionsOption=function(i){return!t.isNullOrUndefined(i.advancedOptions)&&n.isMapped(i)};n.showAdvancedOptionsForm=function(t){return t.showAdvancedOptionsForm&&n.isMapped(t)}});angular.module("umbraco").controller("cmsimport.booleanController",function(n,t){n.itemChanged=function(n){n.value=!n.value;t.$broadcast("cmsimportBooleanCheckbox.changed",{alias:n.alias,value:n.value})}});angular.module("umbraco").controller("cmsimport.radioButtonListController",function(n,t){n.itemChanged=function(n){t.$broadcast("cmsimportRadioButton.changed",{alias:n.name,value:n.value})}});angular.module("umbraco").controller("cmsimport.timeSelectorController",function(n){n.bindData=function(){var t,i;for(n.hours=[],t=0;t<24;t++)n.hours.push(t);for(n.minutes=[],i=0;i<60;i++)n.minutes.push(i)};n.bindData()});angular.module("umbraco").controller("cmsimport.multiStringController",function(n,t,i,r){n.newItem="";n.addItem=function(u,f){i.addMultiStringFieldItem(n.model.value,f).then(function(i){n.model.isInValid||(n.model.value=i.data,n.newItem="",t.$broadcast("cmsimportMultistring.added",{alias:u,value:f}))},function(){r.showServerError()})};n.removeItem=function(u,f){i.removeMultiStringFieldItem(n.model.value,f).then(function(i){n.model.isInValid||(n.model.value=i.data,n.newItem="",t.$broadcast("cmsimportMultistring.removed",{alias:u,value:f}))},function(){r.showServerError()})}});angular.module("umbraco").controller("cmsimport.datasourcePickerController",function(n,t,i){n.init=function(){n.selectedfileName=n.model.value.uploadedFile.fileName};n.uploadChanged=function(){var i=document.getElementById("selectDatasourceFile");n.selectedfileName=i.files[0].name;n.nextfn=t.next;t.next=function(){n.upload()}};t.upload=function(){n.upload()};n.switchUrl=function(){n.model.value.pickerType="urlPicker"};n.switchUpload=function(){n.model.value.pickerType="filePicker"};n.upload=function(){var r=document.getElementById("selectDatasourceFile");i.uploadFiles("datasourceFile",r.files[0],function(i){var r=JSON.parse(i);r.fileChanged=!0;n.model.value.uploadedFile=r;n.selectedfileName=r.fileName;t.next=n.nextfn;t.next()})};n.init()});angular.module("umbraco").controller("cmsimport.dropdownSelectorController",function(n,t){n.itemChanged=function(n){t.$broadcast("cmsimportDropdown.changed",{alias:n.alias,value:n.value.selectedItem})}});angular.module("umbraco").controller("cmsimport.importController",function(n,t,i,r,u,f){n.openStartImport=function(){var i={view:"/app_plugins/cmsimport/overlays/importoverlay.html",title:"Importing please wait",importStatus:n.model.value,disableBackdropClick:!0,hideSubmitButton:!0,closeButtonLabel:"Cancel",submit:function(i){n.importResult=i;t.$broadcast("cmsimportPageTitle.changed",{title:n.importResult.importFinishedTitle,description:n.importResult.importFinishedDescription});u.closeAll();r.close()},close:function(){f.cancel(n.model.value).then(function(i){n.model.importStatus=i.data;n.importResult=n.model.importStatus.result;t.$broadcast("cmsimportPageTitle.changed",{title:n.importResult.importFinishedTitle,description:n.importResult.importFinishedDescription})})}};r.open(i)};n.openStartImport()});angular.module("umbraco.resources").factory("cmsimportBackofficeResources",function(n){return{getLicenseInfo:function(){return n.get("backoffice/cmsimport/cmsimportdashboardapi/licenseinfo")},initializeDashboard:function(){return n.get("backoffice/cmsimport/cmsimportdashboardapi/initialize")},processLicenseFile:function(t){return n.post("backoffice/cmsimport/cmsimportdashboardapi/processlicense",t)},uploadFiles:function(t){return n.post("backoffice/cmsimport/fileuploadapi/upload",t,{transformRequest:angular.identity,headers:{"Content-Type":undefined}})},initializeWizard:function(t){return n.get("backoffice/cmsimport/cmsimportwizardapi/initialize",{params:{id:t}})},goNext:function(t){return n.post("backoffice/cmsimport/cmsimportwizardapi/gonextstep",t)},goPrevious:function(t){return n.post("backoffice/cmsimport/cmsimportwizardapi/gopreviousstep",t)},updateModel:function(t){return n.post("backoffice/cmsimport/cmsimportwizardapi/updatemodel",t)},initializeDefinitionSave:function(t,i){return n.get("backoffice/cmsimport/cmsimportwizardapi/initializeSave?definitionid="+t+"&parentId="+i)},validateDefinitionSaveModel:function(t){return n.post("backoffice/cmsimport/cmsimportwizardapi/validateSaveOptions",t)},saveDefinitionModel:function(t){return n.post("backoffice/cmsimport/cmsimportwizardapi/save",t)},initializeScheduledLog:function(t){return n.get("backoffice/cmsimport/cmsimportschedulerapi/initializelog",{params:{id:t}})},clearScheduledLog:function(t){return n.get("backoffice/cmsimport/cmsimportschedulerapi/clearlog",{params:{id:t}})},initializeScheduledTask:function(t){return n.get("backoffice/cmsimport/cmsimportschedulerapi/initialize",{params:{id:t}})},updateScheduledTask:function(t){return n.post("backoffice/cmsimport/cmsimportschedulerapi/updatemodel",t)},saveScheduledTask:function(t){return n.post("backoffice/cmsimport/cmsimportschedulerapi/save",t)},initializeEmailSettings:function(t){return n.get("backoffice/cmsimport/emailsettingsapi/initialize",{params:{emailConfig:t}})},saveEmailSettings:function(t){return n.post("backoffice/cmsimport/emailsettingsapi/save",t)},initializeDashboardSettings:function(){return n.get("backoffice/cmsimport/cmsimportdashboardsettingsapi/initialize")},saveDashboardSettings:function(t){return n.post("backoffice/cmsimport/cmsimportdashboardsettingsapi/save",t)},initializeMediaSettings:function(){return n.get("backoffice/cmsimport/cmsimportgeneralsettingsapi/initialize")},saveMediaSettings:function(t){return n.post("backoffice/cmsimport/cmsimportgeneralsettingsapi/save",t)},addMultiStringFieldItem:function(t,i){var r={items:t,itemToUpdate:i};return n.post("backoffice/cmsimport/multistringfieldapi/additem",r)},removeMultiStringFieldItem:function(t,i){var r={items:t,itemToUpdate:i};return n.post("backoffice/cmsimport/multistringfieldapi/removeitem",r)},deleteTreeNodeById:function(t){return n.get("backoffice/cmsimport/cmsimporttreeapi/deleteTreeNode?id="+t)},startImport:function(t){return n.post("backoffice/cmsimport/cmsimportimportapi/start",t)},getStatus:function(t){return n.post("backoffice/cmsimport/cmsimportimportapi/getstatus",t)},cancel:function(t){return n.post("backoffice/cmsimport/cmsimportimportapi/cancel",t)}}});angular.module("umbraco.services").factory("cmsimportHelper",function(n,t,i,r){var u={showNotification:function(t){t.isError===!1?n.success(t.header,t.description):n.error(t.header,t.description)},showServerError:function(){n.error("Server error","A server error occured")},applyValidationErrors:function(n,t){t.isInValid=n.isInValid;t.validationMessages=n.validationMessages},syncPath:function(n){t.syncTree({tree:"cmsimport",path:n,forceReload:!0})},isSortDirection:function(n,t,i,r){return n===i&&t===r},handleSelectAll:function(n,t){angular.forEach(t,function(t){t.selected=n})},getSelectedItems:function(n){var t=[];return angular.forEach(n,function(n){n.selected===!0&&t.push(n)}),t},getSelectedIds:function(n,t){var i=[];return angular.forEach(n,function(n){n.selected===!0&&i.push(u.getItemByName(n,t))}),i},anyItemSelected:function(n){var t=!1;return angular.forEach(n,function(n){if(n.selected===!0){t=!0;return}}),t===!0},downloadFile:function(n){var t=document.createElement("a");t.id="downloadframe";t.style.display="none";document.body.appendChild(t);t.href=n;t.click();r(function(){document.body.removeChild(t)},1e3)},uploadFiles:function(n,t,i){var u=new FormData,r;u.set("folderName",n);u.set("file",t,t.name);r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState===4&&i(r.responseText)};r.open("POST","backoffice/cmsimport/fileuploadapi/upload");r.send(u)},getItemByName:function(n,t){for(var r=Object.entries(n),i=0;i<r.length;i++)if(r[i][0]===t)return r[i][1];return null},getTabByAlias:function(n,t){for(var i=0;i<n.length;i++)if(n[i].alias===t)return n[i];return{active:!1,alias:"emptyTab",id:-1,label:"empty",properties:[]}},updateTab:function(n,t,i){var r=u.getTabByAlias(t.tabs,i),f=u.getTabByAlias(n.tabs,i);f.properties=r.properties},isNullOrUndefined:function(n){return n===null||angular.isUndefined(n)},isNullOrEmptyString:function(n){return n===null||angular.isUndefined(n)||n===""},formatDate:function(n){var i=/\d{4}-\d{2}-\d{2}$/.test(n),t;return i?n:n&&n instanceof Date?moment(n).format("YYYY-MM-DD"):n&&(t=utils.parseDate(n),t)?moment(t).format("YYYY-MM-DD"):void 0},parseDate:function(n){if(n&&n.indexOf("0001-01-01")<0){var t=n.replace("T"," ").replace("Z","");return new Date(Date.parse(t))}}};return u});angular.module("umbraco").controller("cmsimport.importOverlayController",function(n,t,i){n.start=function(){i.startImport(n.model.importStatus);n.timer=t(n.getStatus,1e3)};n.getStatus=function(){n.CancelTimer();i.getStatus(n.model.importStatus).then(function(i){n.model.importStatus=i.data;n.model.importStatus.finished?n.model.submit(n.model.importStatus.result):n.timer=t(n.getStatus,200)})};n.CancelTimer=function(){t.cancel(n.timer)};n.start()});